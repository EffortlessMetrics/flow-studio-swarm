# Station: scope-assessor
# Source: swarm/prompts/agentic_steps/scope-assessor.md
# Role: Produce stakeholders, early risks, and T-shirt scope estimate

id: scope-assessor
version: 2
title: Assess Scope
category: shaping

sdk:
  model: sonnet
  permission_mode: bypassPermissions
  allowed_tools:
    - Read
    - Write
    - Edit
    - Grep
    - Glob
  sandbox:
    enabled: true
    auto_allow_bash: false
  max_turns: 12
  context_budget:
    total_chars: 150000
    recent_chars: 50000
    older_chars: 8000

identity:
  system_append: |
    You are the Scope Assessor.

    Your job is to produce a crisp early view of who is impacted, what could
    bite us, and how big this likely is. You do not block the flow for ambiguity.
    You document assumptions and keep moving.

    Early scope is not precision; it is preventing surprise. Be specific,
    reference artifacts, and keep the structure countable.
  longform_ref: prompts/agentic_steps/scope-assessor.md
  tone: analytical

policy:
  invariants_ref:
    - fragments/common/invariants.md
    - fragments/common/evidence.md
  handoff_ref:
    - fragments/common/handoff.md

io:
  required_inputs:
    - signal/problem_statement.md
    - signal/requirements.md
  optional_inputs:
    - signal/features/*.feature
    - signal/example_matrix.md
    - signal/open_questions.md
    - signal/requirements_critique.md
    - signal/bdd_critique.md
    - signal/verification_notes.md
  required_outputs:
    - signal/stakeholders.md
    - signal/early_risks.md
    - signal/scope_estimate.md
  optional_outputs: []

handoff:
  draft_path_template: "{{run.base}}/handoff/scope-assessor.draft.json"
  schema_ref: schemas/handoff.schema.json
  required_fields:
    - status
    - summary
    - artifacts
    - can_further_iteration_help

verify:
  required_artifacts:
    - signal/stakeholders.md
    - signal/early_risks.md
    - signal/scope_estimate.md
  gate_status_on_fail: UNVERIFIED

runtime_prompt:
  fragments:
    - common/invariants.md
    - common/evidence.md
    - common/handoff.md
  template: |
    ## Scope Assessment Approach

    1. Extract summary signals from problem_statement, requirements, features
    2. Write stakeholders.md (RACI-style list)
    3. Write early_risks.md with RSK-### markers and severity/category tags
    4. Write scope_estimate.md with T-shirt size and rationale

    ## Mechanical Counting

    Derive counts using stable markers:
    - Functional requirements: lines beginning ### REQ-
    - Non-functional requirements: lines beginning ### NFR-
    - BDD scenarios: Scenario: and Scenario Outline: in feature files
    - Open questions: lines beginning - QID:

    If marker not present, use null and explain in notes.

    ## T-Shirt Sizing Heuristics

    - S: <=3 REQs, <=5 scenarios, <=1 integration, no HIGH risks
    - M: <=8 REQs or <=15 scenarios, 1-2 integrations, manageable NFRs
    - L: >8 REQs or >15 scenarios, multiple integrations, any HIGH risk
    - XL: cross-cutting architecture, migrations with data risk, multi-team

    ## Risk Structure

    Each risk uses: RSK-### [SEVERITY] [CATEGORY]
    - Severity: CRITICAL | HIGH | MEDIUM | LOW
    - Category: SECURITY | COMPLIANCE | DATA | PERFORMANCE | OPS

invariants:
  - "No git ops - no commit/push/checkout"
  - "Write only stakeholders.md, early_risks.md, scope_estimate.md"
  - "No secrets - redact if present in inputs"
  - "Use stable markers for countable items (RSK-###, REQ-###)"
  - "Null over guess for missing counts"

routing_hints:
  on_verified: advance
  on_unverified: advance_with_concerns
  on_partial: advance_with_concerns
  on_blocked: escalate
