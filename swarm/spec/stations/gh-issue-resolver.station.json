{
  "$schema": "../schemas/station.schema.json",
  "id": "gh-issue-resolver",
  "version": 1,
  "title": "GitHub Issue Resolver",
  "category": "infra",
  "sdk": {
    "model": "haiku",
    "permission_mode": "bypassPermissions",
    "tool_profile": "read_write",
    "allowed_tools": ["Read", "Bash", "Grep", "Glob"],
    "denied_tools": ["Write", "Edit"],
    "sandbox": {
      "enabled": true,
      "auto_allow_bash": true,
      "excluded_commands": ["git push", "git commit", "git reset"]
    },
    "max_turns": 10,
    "context_budget": {
      "total_chars": 100000,
      "recent_chars": 35000,
      "older_chars": 10000
    }
  },
  "identity": {
    "system_append": "You are the GitHub Issue Resolver. Pre-run agent for Flow 1. Resolve or create a GitHub issue before any run directory exists. Compute run_id for downstream agents. Return a control-plane block only; never write files. Deterministic parsing and routing.",
    "longform_ref": "prompts/agentic_steps/gh-issue-resolver.md",
    "tone": "neutral"
  },
  "policy": {
    "invariants_ref": [
      "fragments/common/invariants.md"
    ],
    "handoff_ref": [
      "fragments/common/handoff.md",
      "fragments/common/status_model.md"
    ]
  },
  "io": {
    "required_inputs": [],
    "optional_inputs": [
      "run_meta.json"
    ],
    "required_outputs": [],
    "optional_outputs": []
  },
  "handoff": {
    "draft_path_template": "",
    "required_fields": [
      "status",
      "summary",
      "routing_signal"
    ]
  },
  "runtime_prompt": {
    "fragments": [
      "fragments/common/preflight.md",
      "fragments/common/invariants.md"
    ],
    "template": "## Mission\n\nResolve or create GitHub issue identity before run directory exists.\n\n## Inputs\n\n- signal_text: {{params.signal_text}}\n- issue_ref: {{params.issue_ref}}\n- run_id (optional): {{params.run_id}}\n\n## Behavior\n\n1. Determine repo trust + github_ops_allowed\n2. Check for rerun path (existing run_meta)\n3. Explicit issue path (issue_ref provided)\n4. Create path (no usable issue_ref)\n5. Handle closed issues\n6. Local-only path (repo mismatch)\n7. Output control-plane block only\n\n## Output\n\nReturn GH Issue Result block. Do not write files."
  },
  "invariants": [
    "No filesystem writes - control-plane output only",
    "Deterministic parsing and routing - same inputs yield same result",
    "Issue-first when possible - gh-<issue_number> as run_id",
    "Local-only fallback - local-<slug>-<hash6> when GH unavailable",
    "Never write to .runs/ - orchestrator handles that based on result block"
  ],
  "routing_hints": {
    "on_verified": "advance",
    "on_unverified": "advance_with_concerns",
    "on_partial": "advance_with_concerns",
    "on_blocked": "escalate"
  }
}
