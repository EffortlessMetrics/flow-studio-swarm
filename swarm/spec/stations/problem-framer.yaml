# Station: problem-framer
# Source: swarm/prompts/agentic_steps/problem-framer.md
# Role: Synthesize normalized signal into a crisp, testable problem statement

id: problem-framer
version: 2
title: Frame Problem
category: shaping

sdk:
  model: sonnet
  permission_mode: bypassPermissions
  allowed_tools:
    - Read
    - Write
    - Edit
    - Grep
    - Glob
  sandbox:
    enabled: true
    auto_allow_bash: false
  max_turns: 12
  context_budget:
    total_chars: 150000
    recent_chars: 50000
    older_chars: 8000

identity:
  system_append: |
    You are the Problem Framer.

    Your job is to distill raw signal into a crisp, testable problem statement
    that makes requirements obvious. You convert "what was said" into "what the
    system must address," without prescribing implementation.

    You do not block the flow for ambiguity. You document assumptions and questions
    (with defaults) and keep moving. Distill, don't solve.
  longform_ref: prompts/agentic_steps/problem-framer.md
  tone: analytical

policy:
  invariants_ref:
    - fragments/common/invariants.md
    - fragments/common/evidence.md
  handoff_ref:
    - fragments/common/handoff.md

io:
  required_inputs:
    - signal/issue_normalized.md
    - signal/context_brief.md
  optional_inputs:
    - signal/github_research.md
  required_outputs:
    - signal/problem_statement.md
  optional_outputs: []

handoff:
  draft_path_template: "{{run.base}}/handoff/problem-framer.draft.json"
  schema_ref: schemas/handoff.schema.json
  required_fields:
    - status
    - summary
    - artifacts
    - can_further_iteration_help

verify:
  required_artifacts:
    - signal/problem_statement.md
  gate_status_on_fail: UNVERIFIED

runtime_prompt:
  fragments:
    - common/invariants.md
    - common/evidence.md
    - common/handoff.md
  template: |
    ## Problem Framing Approach

    1. Distill the problem in system terms (what outcome is blocked/degraded)
    2. Apply the State Heuristic: Does this request imply data/schema changes?
       - If YES: Include State Transitions section
       - If NO: State "No schema/storage changes required"
    3. Identify who is affected and blast radius
    4. Document constraints and non-goals
    5. Define success criteria as observable outcomes
    6. Make assumptions with defaults when information is missing
    7. Write problem_statement.md with all sections

    ## State Heuristic (Critical)

    Ask: "Does this request imply a change to how data is stored or structured?"
    - Adding a field, changing config format, renaming DB column = YES
    - Document: what changes, rollout pattern, backwards compatibility

invariants:
  - "No git ops - no commit/push/checkout"
  - "Write only problem_statement.md"
  - "No solutions - state constraints and criteria, not architecture"
  - "No secrets - redact in output if present in inputs"
  - "Assumptions over blocking - document and keep moving"
  - "State transitions must be flagged for Flow 2"

routing_hints:
  on_verified: advance
  on_unverified: loop
  on_partial: advance_with_concerns
  on_blocked: escalate
