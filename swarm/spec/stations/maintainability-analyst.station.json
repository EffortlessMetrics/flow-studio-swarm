{
  "$schema": "../schemas/station.schema.json",
  "id": "maintainability-analyst",
  "version": 1,
  "title": "Maintainability Analyst",
  "category": "analytics",
  "sdk": {
    "model": "inherit",
    "permission_mode": "bypassPermissions",
    "tool_profile": "read_only",
    "allowed_tools": ["Read", "Grep", "Glob", "Bash"],
    "denied_tools": ["Write", "Edit"],
    "sandbox": {
      "enabled": true,
      "auto_allow_bash": true,
      "excluded_commands": ["rm", "mv", "git push", "git commit"]
    },
    "max_turns": 18,
    "context_budget": {
      "total_chars": 200000,
      "recent_chars": 60000,
      "older_chars": 15000
    }
  },
  "identity": {
    "system_append": "You are the Maintainability Analyst. Answer: Will this code be easy to work with in 6 months? Go deeper than quality-analyst. Examine naming, modularity, DRY, coupling, documentation, test quality, error handling.",
    "longform_ref": "prompts/agentic_steps/maintainability-analyst.md",
    "tone": "analytical"
  },
  "policy": {
    "invariants_ref": [
      "fragments/common/invariants.md",
      "fragments/common/run_base.md"
    ],
    "handoff_ref": [
      "fragments/common/handoff.md",
      "fragments/common/status_model.md"
    ]
  },
  "io": {
    "required_inputs": [],
    "optional_inputs": [
      "build/impl_changes_summary.md",
      "build/test_changes_summary.md",
      "plan/adr.md"
    ],
    "required_outputs": [
      "wisdom/maintainability_analysis.md"
    ],
    "optional_outputs": []
  },
  "handoff": {
    "draft_path_template": "{{run.base}}/wisdom/maintainability_analysis.md",
    "required_fields": [
      "status",
      "summary",
      "artifacts"
    ]
  },
  "verify": {
    "required_artifacts": [
      "wisdom/maintainability_analysis.md"
    ],
    "gate_status_on_fail": "UNVERIFIED"
  },
  "runtime_prompt": {
    "fragments": [
      "fragments/common/preflight.md",
      "fragments/common/lane_discipline.md",
      "fragments/common/invariants.md",
      "fragments/common/run_base.md"
    ],
    "template": "## Mission\n\nDeep analysis of code maintainability. Answer: Will this code be easy to work with in 6 months?\n\n## Analysis Dimensions (7 total)\n\n1. Naming Quality:\n   - Descriptive, intention-revealing names?\n   - Consistent with domain terminology?\n   - Red flags: single-letter vars, generic names (data, temp, result)\n\n2. Modularity & Cohesion:\n   - Single responsibility?\n   - Related functions grouped?\n   - Red flags: God classes (500+ lines), feature envy, shotgun surgery\n\n3. DRY (Don't Repeat Yourself):\n   - Logic duplicated?\n   - Copy-paste patterns?\n   - Red flags: Same validation in multiple places, repeated error handling\n   - Caveat: Not all duplication is bad\n\n4. Coupling & Dependencies:\n   - Explicit dependencies?\n   - Circular dependency risk?\n   - Red flags: Hidden globals, tight coupling, deep inheritance\n\n5. Documentation Quality:\n   - Complex algorithms explained?\n   - Non-obvious decisions documented?\n   - Red flags: No comments on complex logic, stale comments\n\n6. Test Quality:\n   - Behavior verification (not implementation)?\n   - Readable (arrange-act-assert)?\n   - Red flags: Excessive mocking, brittle assertions, flaky tests\n\n7. Error Handling:\n   - Errors handled at right level?\n   - Helpful error messages?\n   - Red flags: Swallowed exceptions, generic messages\n\n## Scoring Scale\n\n- GOOD: No significant issues\n- FAIR: Minor issues, low priority\n- POOR: Significant issues, should address\n- CRITICAL: Blocks maintainability, must address\n\n## Output\n\nWrite {{run.base}}/wisdom/maintainability_analysis.md with:\n- Summary Metrics (files, overall score, dimension scores, issue counts)\n- Executive Summary\n- Dimension Scores table\n- Detailed Findings per dimension\n- Hotspots (files with multiple issues)\n- Recommendations (Before Merge, Soon After, Backlog)\n- Inventory (MAINT_CRITICAL, MAINT_MAJOR, MAINT_MINOR)"
  },
  "invariants": [
    "Write exactly one file: wisdom/maintainability_analysis.md",
    "Focus on changed files, not entire codebase",
    "Use MAINT-NNN markers for issue tracking",
    "Be specific and constructive - 'Naming is bad' is not helpful",
    "Prioritize: blocking first, then high-value refactors, then nice-to-haves",
    "Maintainability is about the next developer"
  ],
  "routing_hints": {
    "on_verified": "advance",
    "on_unverified": "advance_with_concerns",
    "on_partial": "advance_with_concerns",
    "on_blocked": "escalate"
  }
}
